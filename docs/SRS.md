# 소프트웨어 요구사항 명세서 (SRS)

## 1. 개요

### 1.1 목적
본 문서는 AI 기반 철학자/상담사 상담 애플리케이션의 요구사항을 정의한다.

### 1.2 범위
- 프로젝트명: AI Counseling App
- 주요 기능: AI 페르소나와의 1:1 상담 대화
- 타겟 플랫폼: Android (Google Play Store)
- 백엔드: Spring Boot + Kotlin

### 1.3 용어 정의
- **상담사**: 역사적 인물 기반 AI 페르소나
- **세션**: 한 상담사와의 대화 단위
- **상담 단계**: AI가 자율 판단하는 5단계 대화 진행 프로세스
- **북마크**: 사용자가 세션을 저장하는 기능

## 2. 기능 요구사항

### 2.1 사용자 관리
- **FR-001**: OAuth 2.0 소셜 로그인 (Google, Kakao, Naver)
- **FR-002**: 닉네임 변경 기능
- **FR-003**: 회원 탈퇴 기능

### 2.2 상담사 관리
- **FR-004**: 상담사 목록 조회 (인기순, 평점순, 최신순)
- **FR-005**: 상담사 상세 정보 조회
- **FR-006**: 즐겨찾기 상담사 관리
- **FR-007**: 상담사 평가 시스템

### 2.3 상담 세션
- **FR-008**: 새 세션 시작 (상담사 선택)
- **FR-009**: AI 자율 5단계 진행
  - ENGAGEMENT (관계 형성)
  - EXPLORATION (문제 탐색)
  - INSIGHT (통찰 유도)
  - ACTION (행동 계획)
  - CLOSING (마무리)
- **FR-010**: 세션 제목 자동 생성 (철 메시지 기반)
- **FR-011**: 세션 북마크 기능
- **FR-012**: 세션 제목 수정 기능

### 2.4 메시지 관리
- **FR-013**: 실시간 대화 (AI 응답 포함)
- **FR-014**: 대화 내역 페이지네이션 조회
- **FR-015**: 메시지별 상담 단계 표시

### 2.5 평가 시스템
- **FR-016**: 세션 종료 후 평가 (1-10점, 별 0.5개 단위)
- **FR-017**: 피드백 텍스트 작성 (최대 500자)

## 3. 비기능 요구사항

### 3.1 성능
- **NFR-001**: API 응답 시간 < 2초
- **NFR-002**: OpenRouter API 타임아웃 120초
- **NFR-003**: 동시 접속 1000명 지원
- **NFR-004**: AI 재시도 최대 3회

### 3.2 보안
- **NFR-005**: JWT 기반 인증 (Access + Refresh Token)
- **NFR-006**: API 키 환경변수 관리
- **NFR-007**: HTTPS 통신
- **NFR-008**: CORS 정책 적용

### 3.3 사용성
- **NFR-009**: 현대적 언어 사용
- **NFR-010**: 자연스러운 대화 흐름
- **NFR-011**: 코드블록 없는 순수 JSON 응답

### 3.4 확장성
- **NFR-012**: 상담사 추가 용이 (base_prompt 기반)
- **NFR-013**: 다국어 지원 가능 구조
- **NFR-014**: N+1 쿼리 방지 (JDSL 사용)

## 4. 시스템 제약사항

### 4.1 기술 스택
- Backend: Kotlin 1.9.25, Spring Boot 3.5.4, WebFlux
- Database: PostgreSQL (운영), H2 (개발)
- AI: OpenRouter API (meta-llama/llama-3.2-3b-instruct)
- Architecture: DDD (도메인 주도 설계)
- Testing: JUnit 5, MockK, Spring MockMvc

### 4.2 운영 환경
- JDK 21
- Docker/Kubernetes (추후)
- GitHub Actions CI/CD

## 5. 인터페이스 요구사항

### 5.1 외부 인터페이스
- OpenRouter API 연동
- OAuth 2.0 (Google, Kakao, Naver)

### 5.2 API 인터페이스
- RESTful API
- OpenAPI 3.0 문서화
- JSON 통신

## 6. 데이터 요구사항

### 6.1 데이터 모델
- users: 사용자 정보 (OAuth 연동)
- counselors: 상담사 정보 + AI 프롬프트
- chat_sessions: 세션 정보
- messages: 대화 내용 + 상담 단계
- favorite_counselors: 즐겨찾기 매핑
- counselor_ratings: 세션 평가

### 6.2 데이터 보존
- 대화 내역: 무제한 보관
- 사용자 정보: 탈퇴 시까지
- 평가 데이터: 영구 보관

## 7. AI 상담 로직

### 7.1 상담 단계 자동 진행
- AI가 대화 맥락을 보고 자율 판단
- 메시지 수 기반 최소 단계 보장
- 이전 단계로 회귀 방지

### 7.2 프롬프트 구조
```
1. 상담사 페르소나 (역사적 인물 특징)
2. 대화 히스토리 (최대 9개 메시지)
3. 단계 전환 규칙
4. JSON 응답 형식
5. 코드블록 사용 금지
```

### 7.3 응답 형식
```json
{
  "content": "상담 응답 내용",
  "phase": "ENGAGEMENT|EXPLORATION|INSIGHT|ACTION|CLOSING",
  "title": "세션 제목 (철 메시지 시만)"
}
```

## 8. 품질 요구사항

### 8.1 테스트
- 단위 테스트 103개 통과 (100% 성공률)
- MockK 기반 모킹 (Mockito 대신)
- 컨트롤러별 테스트 파일 분리

### 8.2 문서화
- API 문서 자동 생성 (Swagger)
- 코드 주석 최소화
- README 유지보수

## 9. 프로젝트 현재 상태

### 완료된 기능 (2025년 1월 기준)
- OAuth 2.0 소셜 로그인 (Google, Kakao, Naver)
- JWT 기반 인증 시스템
- 상담사 목록 조회 및 상세 정보
- 새 세션 시작 및 종료
- AI와 실시간 대화 (5단계 상담 프로세스)
- 세션 북마크 및 제목 관리
- 세션 평가 시스템
- 즐겨찾기 상담사 관리
- 페이지네이션된 데이터 조회
- CI/CD 파이프라인 (GitHub Actions)
- 103개 테스트 통과

### 개발 예정
- Android 앱 개발
- 추가 상담사 확대
- 사용자 대시보드

## 10. 위험 관리

### 10.1 기술적 위험
- OpenRouter API 의존성 → 폴백 전략
- AI 응답 품질 → 프롬프트 최적화
- 응답 속도 → 캐싱 전략

### 10.2 비즈니스 위험
- 사용자 이탈 → 온보딩 개선
- 부적절한 상담 → 면책 조항
- 확장성 → 클라우드 인프라